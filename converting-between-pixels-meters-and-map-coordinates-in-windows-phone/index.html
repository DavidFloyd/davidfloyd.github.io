<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Converting between pixels, meters and map coordinates in Windows Phone</title>
  
  <meta name="author" content="davidmacias"/>
  <meta name="generator" content="Hugo 0.21" />
<link rel="apple-touch-icon" sizes="57x57" href="../apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="../android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="Igor Kulman">

 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />  

  
  
 
  
    <meta property="og:title" content="Converting between pixels, meters and map coordinates in Windows Phone" />
  

  
    <meta property="og:description" content="In my current project I needed to solve one quite interesting problem. Imagine you have a map with some pins representing points of interest. If the user taps on a pin, a label with the place title is shown like on this image (that is not from the real project, obviously).
The client had an interesting requirement. When the user taps the pin and the label is shown, they wanted the label to be centered on the map (basically move the map so the label appears in the middle of the map).

In Windows Phone you can only center the map to a GeoCoordinate. If you center the map to the tapped pin&amp;amp;#8217;s coordinate, it is not quite right, you also need to move it by half the width of the label to the left (and half of the height down). So the solution consists of two steps
 Convert half of the label width in pixels to meters for a given zoom level (pixels -&amp;amp;gt; meters conversion) Subtract the result from the pin&amp;amp;#8217;s coordinate (meters -&amp;amp;gt; degrees conversion)  (and the same for height)
The map component in Windows Phone 8 and 8.1 has quite a nice documentation, so the first step requires some math but is not so difficult.
I created two helper functions to take care of this first conversion
 The second conversion is more difficult, especially if you want to do it really well. I found a simple solution that works quite ok when you are not right at the poles and used it. The helper function looks like this.
 Now you just need to put it all together and you are done.
">
  

  <meta property="og:type" content="website" />

  
    <meta property="og:url" content="/converting-between-pixels-meters-and-map-coordinates-in-windows-phone/" />
    <link rel="canonical" href="../converting-between-pixels-meters-and-map-coordinates-in-windows-phone/" />
  

  
    <meta property="og:image" content="img/avatar-icon.png" />
  
  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@davidmacias" />
  <meta name="twitter:creator" content="@davidmacias" />

  
    <meta name="twitter:title" content="Converting between pixels, meters and map coordinates in Windows Phone" />
  

  
    <meta name="twitter:description" content="In my current project I needed to solve one quite interesting problem. Imagine you have a map with some pins representing points of interest. If the user taps on a pin, a label with the place title is shown like on this image (that is not from the real project, obviously).
The client had an interesting requirement. When the user taps the pin and the label is shown, they wanted the label to be centered on the map (basically move the map so the label appears in the middle of the map).

In Windows Phone you can only center the map to a GeoCoordinate. If you center the map to the tapped pin&amp;amp;#8217;s coordinate, it is not quite right, you also need to move it by half the width of the label to the left (and half of the height down). So the solution consists of two steps
 Convert half of the label width in pixels to meters for a given zoom level (pixels -&amp;amp;gt; meters conversion) Subtract the result from the pin&amp;amp;#8217;s coordinate (meters -&amp;amp;gt; degrees conversion)  (and the same for height)
The map component in Windows Phone 8 and 8.1 has quite a nice documentation, so the first step requires some math but is not so difficult.
I created two helper functions to take care of this first conversion
 The second conversion is more difficult, especially if you want to do it really well. I found a simple solution that works quite ok when you are not right at the poles and used it. The helper function looks like this.
 Now you just need to put it all together and you are done.
">
  

  
    <meta name="twitter:image" content="img/avatar-icon.png" />
   

</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="">Igor Kulman</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="../">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Projects" href="../projects/">Projects</a>
            </li>
          
        
          
            <li>
              <a title="About me / contact" href="../about/">About me / contact</a>
            </li>
          
        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Igor Kulman" href="">
            <img class="avatar-img" src="../img/avatar-icon.png" alt="Igor Kulman" />
          </a>
        
      </div>
    </div>

  </div>
</nav>

    
  

  <header class="header-section ">
    
    <div class="intro-header no-img">
        <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Converting between pixels, meters and map coordinates in Windows Phone</h1>
            

            
              <span class="post-meta">Posted on June 24, 2014</span>
            
        </div>
      </div>
    </div>
  </div>
    </div>
  </header>


    <div class="container" role="main">
      
        <div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>In my current project I needed to solve one quite interesting problem. Imagine you have a map with some pins representing points of interest. If the user taps on a pin, a label with the place title is shown like on this image (that is not from the real project, obviously).</p>

<img src="../images/image_thumb_4_4.png" alt="" class="pure-img" >

<p>The client had an interesting requirement. When the user taps the pin and the label is shown, they wanted the label to be centered on the map (basically move the map so the label appears in the middle of the map).</p>

<p></p>

<p>In Windows Phone you can only center the map to a GeoCoordinate. If you center the map to the tapped pin&#8217;s coordinate, it is not quite right, you also need to move it by half the width of the label to the left (and half of the height down). So the solution consists of two steps</p>

<ol>
<li>Convert half of the label width in pixels to meters for a given zoom level (pixels -&gt; meters conversion)</li>
<li>Subtract the result from the pin&#8217;s coordinate (meters -&gt; degrees conversion)</li>
</ol>

<p>(and the same for height)</p>

<p>The map component in Windows Phone 8 and 8.1 has quite a <a href="http://msdn.microsoft.com/en-us/library/aa940990.aspx">nice documentation</a>, so the first step requires some math but is not so difficult.</p>

<p>I created two helper functions to take care of this first conversion</p>

<div data-gist="9fa0a229b9c2db57a172" data-file="meters.cs"></div>

<p>The second conversion is more difficult, especially if you want to do it really well. I found a <a href="https://gis.stackexchange.com/questions/2951/algorithm-for-offsetting-a-latitude-longitude-by-some-amount-of-meters">simple solution that works quite ok when you are not right at the poles</a> and used it. The helper function looks like this.</p>

<div data-gist="9fa0a229b9c2db57a172" data-file="coords.cs"></div>

<p>Now you just need to put it all together and you are done.</p>
      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="../ignoring-certificate-errors-in-windows-phone-8-1/" data-toggle="tooltip" data-placement="top" title="Ignoring certificate errors in Windows Phone 8.1">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="../automatic-viewmodels-and-services-registration-for-not-only-caliburn-micro/" data-toggle="tooltip" data-placement="top" title="Automatic ViewModels and Services registration for (not only) Caliburn.Micro">Next Post &rarr;</a>
          </li>
        
      </ul>

       <div class="pure-g" style="margin-bottom:1em">

   <div class="pure-u-1-2">
   <p style="text-align:right">This content is open source. 
   Please <a href="https://github.com/igorkulman/coding-journal/edit/master/content/post/post%5c2014-06-24-converting-between-pixels-meters-and-map-coordinates-in-windows-phone.md" title="Help improve article post\2014-06-24-converting-between-pixels-meters-and-map-coordinates-in-windows-phone.md">help improve it</a>.</p>
  </div>
</div>

      
        
          <div class="disqus-comments">                  
            <button id="show-comments" class="btn btn-default" type="button">Show <span class="disqus-comment-count" data-disqus-url="converting-between-pixels-meters-and-map-coordinates-in-windows-phone">comments</span></button>
            <div id="disqus_thread"></div>

            <script type="text/javascript">
              var disqus_config = function () {
              this.page.url = 'converting-between-pixels-meters-and-map-coordinates-in-windows-phone';
            };

          </script>
          </div>
        
      

    </div>
  </div>
</div>

      
    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          <li>
            <a href="mailto:igor@kulman.sk" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          <li>
            <a href="https://github.com/davidmacias" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li>
            <a href="https://twitter.com/davidmacias" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li>
            <a href="../index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          davidmacias
          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="">Igor Kulman</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.21</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="../js/main.js"></script>
<script src="../js/gist.js"></script>

<script type="text/javascript">
$(function(){
  $('#show-comments').on('click', function(){
    var disqus_shortname = 'coudingjournal';

    (function() {
      var disqus = document.createElement('script'); 
      disqus.type = 'text/javascript'; 
      disqus.async = true;
      disqus.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(disqus);
    })();

    $(this).hide(); 
  });
});

</script>
<script id="dsq-count-scr" src="//coudingjournal.disqus.com/count.js" async></script>



<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49528577-2', 'auto');
ga('send', 'pageview');
</script>



  </body>
</html>
