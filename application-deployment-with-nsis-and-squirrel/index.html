<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Application deployment with NSIS and Squirrel</title>
  <meta name="description" content="Currently working on a WPF app as a side project I came upon and interesting requirement regarding installation and deployment of the application. As a result I ended with some Squirrel and NSIS knowledge I would like to share.">
  <meta name="author" content="davidmacias"/>
  <meta name="generator" content="Hugo 0.21" />
<link rel="apple-touch-icon" sizes="57x57" href="../apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="../apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="../apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="../apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="../apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="../apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="../apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="../apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="../android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

  <link rel="alternate" href="../index.xml" type="application/rss+xml" title="Igor Kulman">

 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="../css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />  

  
  
 
  
    <meta property="og:title" content="Application deployment with NSIS and Squirrel" />
  

  
    <meta property="og:description" content="Currently working on a WPF app as a side project for Netglade I came upon and interesting requirement regarding installation and deployment of the application. As a result I ended with some Squirrel and NSIS knowledge I would like to share.

Requirements
The client came with a specific set of requirement for the installer
 Check for .NET 4.5.2 and offer installation if not present Install the application for all users (Program Files) Install a hardware driver as part of the install process Create desktop and start menu shortcuts Create an uninstaller Set the application to start after boot / logon  and the update process
 a Check for updates button in the app automatically and installing a newer version if available periodically checking for updates and installing them silently when app is minimized to tray  Squirrel
As you may have noticed, most .NET apps nowdays use Squirrel.Windows. The problem with Squirrel is that it cannot install a hardware driver as part of the installation process and it typically install applications to the users profile. But Squirrel is a good choice for the applictaion update requirements, so we decided to combine it with a classic installer.
NSIS
We came up with an idea to combine Squirrel with NSIS. We chose NSIS because it seemed reasonable. I think it is the best of bad choices. The documentation is not very good, especially when using MUI to create a GUI with some meaningful texts and branding.
The idea was to create a NSIS installer that install the hardware driver and a Squirrel app packages and make the updates work after such installation.
Solution
The final solution consisted of multiple things combined together. We added Squirrel to the build process of the app, so each build in Release created a Squirrel install package. Then we created the NSIS installer that
 Checks for .NET 4.5.2 presence (using the NsisDotNetChecker plugin) Copies and installs the hardware driver (using a /s switch for instalaltion without a GUI) Installs the Squirrel package by unpacking it to the install directory in Program Files (using the NsUnzip plugin) Set appropriate permission for the install directory (using the AccessControl plugin) Copies Squirrel.exe as Update.exe to the install directory Creates shortcuts using the Update.exe instead of the app binary  To make Squirrel work in this scenario we also had to create a SquirrelTemp directory one level above the install directory and make it writeable.
We also had to create a custom update logic to check for new releases and restart the app with full path to correct exe file, but in the ends, it all works.
">
  

  <meta property="og:type" content="website" />

  
    <meta property="og:url" content="/application-deployment-with-nsis-and-squirrel" />
    <link rel="canonical" href="../application-deployment-with-nsis-and-squirrel" />
  

  
    <meta property="og:image" content="img/avatar-icon.png" />
  
  
  
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@davidmacias" />
  <meta name="twitter:creator" content="@davidmacias" />

  
    <meta name="twitter:title" content="Application deployment with NSIS and Squirrel" />
  

  
    <meta name="twitter:description" content="Currently working on a WPF app as a side project for Netglade I came upon and interesting requirement regarding installation and deployment of the application. As a result I ended with some Squirrel and NSIS knowledge I would like to share.

Requirements
The client came with a specific set of requirement for the installer
 Check for .NET 4.5.2 and offer installation if not present Install the application for all users (Program Files) Install a hardware driver as part of the install process Create desktop and start menu shortcuts Create an uninstaller Set the application to start after boot / logon  and the update process
 a Check for updates button in the app automatically and installing a newer version if available periodically checking for updates and installing them silently when app is minimized to tray  Squirrel
As you may have noticed, most .NET apps nowdays use Squirrel.Windows. The problem with Squirrel is that it cannot install a hardware driver as part of the installation process and it typically install applications to the users profile. But Squirrel is a good choice for the applictaion update requirements, so we decided to combine it with a classic installer.
NSIS
We came up with an idea to combine Squirrel with NSIS. We chose NSIS because it seemed reasonable. I think it is the best of bad choices. The documentation is not very good, especially when using MUI to create a GUI with some meaningful texts and branding.
The idea was to create a NSIS installer that install the hardware driver and a Squirrel app packages and make the updates work after such installation.
Solution
The final solution consisted of multiple things combined together. We added Squirrel to the build process of the app, so each build in Release created a Squirrel install package. Then we created the NSIS installer that
 Checks for .NET 4.5.2 presence (using the NsisDotNetChecker plugin) Copies and installs the hardware driver (using a /s switch for instalaltion without a GUI) Installs the Squirrel package by unpacking it to the install directory in Program Files (using the NsUnzip plugin) Set appropriate permission for the install directory (using the AccessControl plugin) Copies Squirrel.exe as Update.exe to the install directory Creates shortcuts using the Update.exe instead of the app binary  To make Squirrel work in this scenario we also had to create a SquirrelTemp directory one level above the install directory and make it writeable.
We also had to create a custom update logic to check for new releases and restart the app with full path to correct exe file, but in the ends, it all works.
">
  

  
    <meta name="twitter:image" content="img/avatar-icon.png" />
   

</head>


  <body>

    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="">Igor Kulman</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="../">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Projects" href="../projects/">Projects</a>
            </li>
          
        
          
            <li>
              <a title="About me / contact" href="../about/">About me / contact</a>
            </li>
          
        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Igor Kulman" href="">
            <img class="avatar-img" src="../img/avatar-icon.png" alt="Igor Kulman" />
          </a>
        
      </div>
    </div>

  </div>
</nav>

    
  

  <header class="header-section ">
    
    <div class="intro-header no-img">
        <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Application deployment with NSIS and Squirrel</h1>
            

            
              <span class="post-meta">Posted on June 22, 2016</span>
            
        </div>
      </div>
    </div>
  </div>
    </div>
  </header>


    <div class="container" role="main">
      
        <div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>Currently working on a WPF app as a side project for <a href="http://www.netglade.cz/">Netglade</a> I came upon and interesting requirement regarding installation and deployment of the application. As a result I ended with some Squirrel and NSIS knowledge I would like to share.</p>

<p></p>

<p><strong>Requirements</strong></p>

<p>The client came with a specific set of requirement for the installer</p>

<ul>
<li>Check for .NET 4.5.2 and offer installation if not present</li>
<li>Install the application for all users (Program Files)</li>
<li>Install a hardware driver as part of the install process</li>
<li>Create desktop and start menu shortcuts</li>
<li>Create an uninstaller</li>
<li>Set the application to start after boot / logon</li>
</ul>

<p>and the update process</p>

<ul>
<li>a Check for updates button in the app</li>
<li>automatically and installing a newer version if available</li>
<li>periodically checking for updates and installing them silently when app is minimized to tray</li>
</ul>

<p><strong>Squirrel</strong></p>

<p>As you may have noticed, most .NET apps nowdays use <a href="https://github.com/Squirrel/Squirrel.Windows">Squirrel.Windows</a>. The problem with Squirrel is that it cannot install a hardware driver as part of the installation process and it typically install applications to the users profile. But Squirrel is a good choice for the applictaion update requirements, so we decided to combine it with a classic installer.</p>

<p><strong>NSIS</strong></p>

<p>We came up with an idea to combine Squirrel with <a href="http://nsis.sourceforge.net/Main_Page">NSIS</a>. We chose NSIS because it seemed reasonable. I think it is the best of bad choices. The documentation is not very good, especially when using MUI to create a GUI with some meaningful texts and branding.</p>

<p>The idea was to create a NSIS installer that install the hardware driver and a Squirrel app packages and make the updates work after such installation.</p>

<p><strong>Solution</strong></p>

<p>The final solution consisted of multiple things combined together. We added Squirrel to the build process of the app, so each build in Release created a Squirrel install package. Then we created the NSIS installer that</p>

<ul>
<li>Checks for .NET 4.5.2 presence (using the <a href="https://github.com/ReVolly/NsisDotNetChecker">NsisDotNetChecker plugin</a>)</li>
<li>Copies and installs the hardware driver (using a <code>/s</code> switch for instalaltion without a GUI)</li>
<li>Installs the Squirrel package by unpacking it to the install directory in Program Files (using the <a href="http://nsis.sourceforge.net/NsUnzip_plugin">NsUnzip plugin</a>)</li>
<li>Set appropriate permission for the install directory (using the <a href="http://nsis.sourceforge.net/AccessControl_plug-in">AccessControl plugin</a>)</li>
<li>Copies Squirrel.exe as Update.exe to the install directory</li>
<li>Creates shortcuts using the Update.exe instead of the app binary</li>
</ul>

<p>To make Squirrel work in this scenario we also had to create a <code>SquirrelTemp</code> directory one level above the install directory and make it writeable.</p>

<p>We also had to create a <a href="https://gist.github.com/igorkulman/702be46eacba7bfe3f1444815aef645a">custom update logic</a> to check for new releases and restart the app with full path to correct exe file, but in the ends, it all works.</p>
      </article>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="../creating-a-simple-windows-10-game-with-win2d/" data-toggle="tooltip" data-placement="top" title="Creating a simple Windows 10 game with Win2D">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="../fixing-first-annoyances-with-bash-on-windows/" data-toggle="tooltip" data-placement="top" title="Fixing first annoyances with Bash on Windows">Next Post &rarr;</a>
          </li>
        
      </ul>

       <div class="pure-g" style="margin-bottom:1em">

   <div class="pure-u-1-2">
   <p style="text-align:right">This content is open source. 
   Please <a href="https://github.com/igorkulman/coding-journal/edit/master/content/post/post%5c2016-06-22-application-deployment-with-nsis-and-squirrel.md" title="Help improve article post\2016-06-22-application-deployment-with-nsis-and-squirrel.md">help improve it</a>.</p>
  </div>
</div>

      
        
          <div class="disqus-comments">                  
            <button id="show-comments" class="btn btn-default" type="button">Show <span class="disqus-comment-count" data-disqus-url="application-deployment-with-nsis-and-squirrel">comments</span></button>
            <div id="disqus_thread"></div>

            <script type="text/javascript">
              var disqus_config = function () {
              this.page.url = 'application-deployment-with-nsis-and-squirrel';
            };

          </script>
          </div>
        
      

    </div>
  </div>
</div>

      
    </div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          <li>
            <a href="mailto:igor@kulman.sk" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          <li>
            <a href="https://github.com/davidmacias" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li>
            <a href="https://twitter.com/davidmacias" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li>
            <a href="../index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          davidmacias
          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="">Igor Kulman</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.21</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="../js/main.js"></script>
<script src="../js/gist.js"></script>

<script type="text/javascript">
$(function(){
  $('#show-comments').on('click', function(){
    var disqus_shortname = 'coudingjournal';

    (function() {
      var disqus = document.createElement('script'); 
      disqus.type = 'text/javascript'; 
      disqus.async = true;
      disqus.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(disqus);
    })();

    $(this).hide(); 
  });
});

</script>
<script id="dsq-count-scr" src="//coudingjournal.disqus.com/count.js" async></script>



<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49528577-2', 'auto');
ga('send', 'pageview');
</script>



  </body>
</html>
